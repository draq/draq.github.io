<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="description" content="Table of Characters">
  <title>Table of Characters</title>
  <link rel="icon" href="favicon.svg">
  <link rel="stylesheet" type="text/css" href="stylesheet.css">
  <script src="symbols.js"></script>
  <script src="sexagenary-cycle.js"></script>
</head>

<body>
  <header>
    <h1>Table of Characters</h1>
  </header>
  <main>
    <section>
      <h2>天干</h2>
      <table id="tiangan">
      </table>
    </section>
    <section>
      <h2>地支</h2>
      <table id="dizhi">
      </table>
    </section>
    <section>
      <h2>干支</h2>
      <table>
        <thead>
          <tr id="ganzhi-caption">
            <td></td>
          </tr>
        </thead>
        <tbody id="ganzhi-table" class="decorated">
        </tbody>
      </table>
    </section>
    <section>
      <h2>Planets</h2>
      <table id="planets">
      </table>
    </section>
    <section>
      <h2>Eastern Arabic Numerals</h2>
      <table id="arabic-numerals">
      </table>
    </section>
    <section>
      <h2>节气</h2>
      <table id="jieqi">
      </table>
    </section>
    <section>
      <h2>八卦</h2>
      <table id="bagua">
      </table>
    </section>
    <section>
      <h2>六十四卦</h2>
      <table id="liusigua">
        <thead>
          <tr id="liusigua-caption">
            <td></td>
          </tr>
        </thead>
        <tbody id="liusigua-table" class="decorated">
        </tbody>
      </table>
    </section>
  </main>
  <footer>
  </footer>
  <script>

    // Create Sexagenary Table Caption
    let sexagenaryCaption = document.getElementById("ganzhi-caption");
    EARTHLY_BRANCHES.slice(1).forEach((elem) => {
      let col = document.createElement("td");
      col.innerText = elem[0];
      sexagenaryCaption.appendChild(col);
    });

    // Add Sexagenary Table Rows
    let sexagenaryTable = document.getElementById("ganzhi-table");
    let row = undefined;
    for (let i = 0; i < 60; i++) {
      if (i % 12 == 0) {
        row = document.createElement("tr");
        let col = document.createElement("td");
        j = i % 10;
        col.innerText = HEAVENLY_STEMS.slice(1)[j][0];
        row.appendChild(col); 
      }            
      let col = document.createElement("td");
      col.innerHTML = getSexagenaryCycle(i);
      row.appendChild(col);
      if ((i + 1) % 12 == 0) {
        sexagenaryTable.appendChild(row);
      }
    }

    let bagua = BAGUA.slice(7);

    let liusiguaCaption = document.getElementById('liusigua-caption');
    bagua.forEach((elem) => {
      let col = document.createElement("td");
      col.innerText = elem[0];
      liusiguaCaption.appendChild(col);
    });

    let liusiguaTable = document.getElementById("liusigua-table");
    for (let i = 0; i < 64; i++) {
      if (i % 8 == 0) {
        row = document.createElement("tr");
        let col = document.createElement("td");
        col.innerText = bagua[Math.floor(i / 8)][0];
        row.appendChild(col);
      }
      let col = document.createElement('td');
      col.innerHTML = getGua(i);
      row.appendChild(col);
      if ((i + 1) % 8 == 0) {
        liusiguaTable.appendChild(row);
      }
    }


    function createVerticalTable(elemList, tableElem) {
      let header = document.createElement('thead');
      let body = document.createElement('tbody');
      tableElem.appendChild(header);
      tableElem.appendChild(body);
      headerRow = document.createElement('tr');
      header.appendChild(headerRow);
      elemList[0].forEach((val, _) => {
        let td = document.createElement('td');
        td.innerText = val;
        headerRow.appendChild(td);
      })

      elemList.slice(1).forEach((values, _) => {
        let row = document.createElement('tr');
        values.forEach((val, idx) => {
          let td = document.createElement('td');
          td.innerText = val;
          if (idx == 2) { // special sauce for solar terms
            td.classList.add('degree');
          }
          row.appendChild(td);
        });
        body.appendChild(row);
      });
    }

    function createHorizontalTable(elemList, tableElem, withIndex = true, decorated = true) {
      let dimension = (typeof elemList[0] == "string" ? 1 : elemList[0].length) + (withIndex ? 1 : 0);
      let rows = Array.from({length: dimension}, (_, i) => document.createElement('tr'));
      let header = document.createElement('thead');
      let body = document.createElement('tbody');
      tableElem.appendChild(header);
      tableElem.appendChild(body);
      if (decorated) {
        body.classList.add('decorated');
      }
      header.appendChild(rows[0]);
      rows.slice(1).forEach((row, _) => body.appendChild(row));

      elemList.forEach((values, idx) => {
        if (!Array.isArray(values)) {
          values = [values];
        }
        if (withIndex) {
          if (idx === 0  && decorated) {
            idx = '次序';
          }
          values.unshift(idx);
        }

        values.forEach((val, idx) => {
          let td = document.createElement('td');
          td.innerText = val;
          rows[idx].appendChild(td);
        });
      });
    }

    // Add heavenly stems
    createHorizontalTable(HEAVENLY_STEMS, document.getElementById("tiangan"));
    // Add earthly branches
    createHorizontalTable(EARTHLY_BRANCHES, document.getElementById("dizhi"));

    // Add solar terms
    createVerticalTable(SOLAR_TERMS, document.getElementById("jieqi"));
    // Add planetary symbols
    createHorizontalTable(PLANETARY_SYMBOLS, document.getElementById("planets"), false);
    // Add eastern Arabic numberals
    createHorizontalTable(EASTERN_ARABIC_NUMERALS, document.getElementById("arabic-numerals"), true, false);
    
    // Add 八卦
    createHorizontalTable(BAGUA, document.getElementById("bagua"), false);
  </script>
</body>

</html>